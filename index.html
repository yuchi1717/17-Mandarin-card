<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>17 Mandarin：專業字卡產生器</title>
    <script src="https://unpkg.com/pinyin-pro"></script>
    <style>
        :root {
            --bg-color: #f9f9f9; 
            --section-bg: #ffffff;
            --primary-orange: #e67e22;
            --primary-green: #4db683;
            --light-gray: #eeeeee;
            --text-main: #2c3e50;
            --border-dashed: #d1d5db;
        }

        body {
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 網頁頁首 Logo */
        header {
            text-align: center;
            padding: 40px 0 20px 0;
        }
        .header-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 5px;
        }
        .logo-circle {
            background-color: var(--primary-orange);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
        }
        .header-title {
            font-size: 32px;
            font-weight: bold;
            color: #333;
            margin: 0;
        }
        .header-subtitle {
            font-size: 14px;
            color: #777;
            margin: 0;
        }

        .main-card {
            background: white;
            width: 90%;
            max-width: 1000px;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            margin-bottom: 50px;
        }

        .section-label {
            font-weight: bold;
            font-size: 15px;
            margin-bottom: 12px;
            display: block;
        }

        textarea {
            width: 100%;
            height: 100px;
            padding: 15px;
            box-sizing: border-box;
            border: 1px solid #eee;
            border-radius: 12px;
            font-size: 16px;
            background: #fafafa;
            resize: none;
            outline: none;
            margin-bottom: 25px;
        }

        /* 4格設定網格 */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .setting-box {
            background: #fff;
            padding: 18px;
            border-radius: 15px;
            border: 1px solid #f0f0f0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 125px;
        }

        .setting-header {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: bold;
            color: #555;
        }
        
        /* 線條圖示樣式 */
        .icon-svg {
            width: 18px;
            height: 18px;
            fill: none;
            stroke: #777;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .layout-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
        }
        .layout-inputs input {
            width: 45px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 6px;
            text-align: center;
            background: #fdfdf8;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="color"] {
            border: none;
            width: 28px;
            height: 28px;
            padding: 0;
            background: none;
            cursor: pointer;
        }

        .show-toggle {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            cursor: pointer;
        }

        /* 拉桿樣式優化：淺色背景、無邊框 */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: var(--light-gray);
            border-radius: 10px;
            border: none;
            outline: none;
            margin: 10px 0;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--primary-orange);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .percent-label {
            font-size: 11px;
            color: #999;
            text-align: right;
            display: block;
        }

        .upload-btn {
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            width: fit-content;
            color: #555;
        }

        /* 底部按鈕 */
        .footer-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn-group {
            display: flex;
            gap: 12px;
        }
        .btn {
            padding: 10px 24px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            transition: 0.2s;
        }
        .btn-orange { background-color: var(--primary-orange); }
        .btn-green { background-color: var(--primary-green); }
        .btn:hover { opacity: 0.9; }
        
        /* 按鈕圖示強制為白色 */
        .btn .icon-svg { stroke: #fff; }

        .usage-hint {
            font-size: 12px;
            color: #666;
        }

        /* 字卡區預覽 */
        .page {
            width: 297mm;
            height: 210mm;
            padding: 15mm;
            box-sizing: border-box;
            background: white;
            display: grid;
            gap: 8mm;
            margin-bottom: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            page-break-after: always;
        }
        .card {
            border: 2px dashed var(--border-dashed);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            background: white;
            padding: 10px;
            box-sizing: border-box;
        }
        .card-logo {
            position: absolute;
            top: 5mm; left: 5mm;
            max-width: 15%; max-height: 15%;
            object-fit: contain;
        }
        .pinyin-text, .char-text {
            text-align: center;
            outline: none;
            width: 100%;
            z-index: 10;
        }

        @media print {
            header, .main-card { display: none !important; }
            body { background: none; padding: 0; }
            .page { margin: 0; box-shadow: none; }
            @page { size: A4 landscape; margin: 0; }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-logo">
            <div class="logo-circle">T</div>
            <h1 class="header-title">17 Mandarin</h1>
        </div>
        <p class="header-subtitle">字卡產生器</p>
    </header>

    <div class="main-card">
        <span class="section-label">輸入文字</span>
        <textarea id="inputText" placeholder="謝謝/老師/台灣/漂亮/朋友/學習/開心/太陽/月亮" oninput="generateCards()">謝謝/老師/台灣/漂亮/朋友/學習/開心/太陽/月亮</textarea>

        <div class="settings-grid">
            <!-- 1. 版面配置 (Grid Icon) -->
            <div class="setting-box">
                <div class="setting-header">
                    <svg class="icon-svg" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                    版面配置
                </div>
                <div class="layout-inputs">
                    <input type="number" id="gridCols" value="3" min="1" oninput="generateCards()">
                    <span>×</span>
                    <input type="number" id="gridRows" value="3" min="1" oninput="generateCards()">
                </div>
            </div>

            <!-- 2. 漢字顏色與大小設定 (Type Icon) -->
            <div class="setting-box">
                <div class="setting-header">
                    <svg class="icon-svg" viewBox="0 0 24 24"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>
                    漢字顏色與大小設定
                </div>
                <div class="control-row">
                    <input type="color" id="charColor" value="#2c3e50" oninput="generateCards()">
                </div>
                <input type="range" id="charScale" min="50" max="150" value="100" oninput="handleSlider(this, 'cVal')">
                <span class="percent-label" id="cVal">100%</span>
            </div>

            <!-- 3. 拼音顏色與大小設定 (Speech Icon - New) -->
            <div class="setting-box">
                <div class="setting-header">
                    <svg class="icon-svg" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    拼音顏色與大小設定
                </div>
                <div class="control-row">
                    <input type="color" id="pinyinColor" value="#7f8c8d" oninput="generateCards()">
                    <label class="show-toggle"><input type="checkbox" id="showPinyin" checked onchange="generateCards()"> 顯示</label>
                </div>
                <input type="range" id="pinyinScale" min="50" max="150" value="100" oninput="handleSlider(this, 'pVal')">
                <span class="percent-label" id="pVal">100%</span>
            </div>

            <!-- 4. Logo 圖片 (Image Icon) -->
            <div class="setting-box">
                <div class="setting-header">
                    <svg class="icon-svg" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                    Logo 圖片
                </div>
                <div class="control-row" style="margin-top:5px;">
                    <label class="upload-btn">
                        <svg class="icon-svg" style="width:14px;height:14px;" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                        上傳 <input type="file" id="logoInput" accept="image/*" style="display:none">
                    </label>
                    <button id="removeLogoBtn" style="display:none; color: #bbb; border:none; background:none; cursor:pointer; font-size:12px;" onclick="removeLogo()">移除</button>
                </div>
            </div>
        </div>

        <div class="footer-actions">
            <div class="btn-group">
                <button class="btn btn-orange" onclick="generateCards()">
                    <svg class="icon-svg" viewBox="0 0 24 24"><path d="M12 2v1m0 18v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m0-12.728l.707.707m11.314 11.314l.707.707"></path></svg>
                    產生字卡
                </button>
                <button class="btn btn-green" onclick="window.print()">
                    <svg class="icon-svg" viewBox="0 0 24 24"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                    列印成 PDF
                </button>
            </div>
            <div class="usage-hint">
                使用說明：使用 <strong>/</strong> 或換行切分字卡。產生後可直接點擊文字修改。
            </div>
        </div>
    </div>

    <div id="print-area"></div>

    <script>
        let uploadedLogoBase64 = null;

        function handleSlider(slider, labelId) {
            document.getElementById(labelId).innerText = slider.value + "%";
            generateCards();
        }

        document.getElementById('logoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    uploadedLogoBase64 = event.target.result;
                    document.getElementById('removeLogoBtn').style.display = 'inline';
                    generateCards();
                };
                reader.readAsDataURL(file);
            }
        });

        function removeLogo() {
            uploadedLogoBase64 = null;
            document.getElementById('logoInput').value = "";
            document.getElementById('removeLogoBtn').style.display = 'none';
            generateCards();
        }

        function generateCards() {
            const text = document.getElementById('inputText').value;
            const cols = parseInt(document.getElementById('gridCols').value) || 3;
            const rows = parseInt(document.getElementById('gridRows').value) || 3;
            
            const pColor = document.getElementById('pinyinColor').value;
            const cColor = document.getElementById('charColor').value;
            const pScale = document.getElementById('pinyinScale').value / 100;
            const cScale = document.getElementById('charScale').value / 100;
            const isPinyinEnabled = document.getElementById('showPinyin').checked;

            const words = text.split(/[\/\n\r]+/).filter(w => w.trim() !== "");
            const container = document.getElementById('print-area');
            container.innerHTML = '';

            if (words.length === 0) return;

            const itemsPerPage = cols * rows;

            for (let i = 0; i < words.length; i += itemsPerPage) {
                const pageDiv = document.createElement('div');
                pageDiv.className = 'page';
                pageDiv.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
                pageDiv.style.gridTemplateRows = `repeat(${rows}, 1fr)`;

                const pageWords = words.slice(i, i + itemsPerPage);
                
                pageWords.forEach(word => {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card';

                    if (uploadedLogoBase64) {
                        const logoImg = document.createElement('img');
                        logoImg.src = uploadedLogoBase64;
                        logoImg.className = 'card-logo';
                        cardDiv.appendChild(logoImg);
                    }

                    if (isPinyinEnabled) {
                        const pinyinDiv = document.createElement('div');
                        pinyinDiv.className = 'pinyin-text';
                        pinyinDiv.contentEditable = "true";
                        pinyinDiv.style.color = pColor;
                        pinyinDiv.style.fontSize = (32 * pScale) + "px";
                        pinyinDiv.innerText = pinyinPro.pinyin(word, { toneType: 'symbol' });
                        cardDiv.appendChild(pinyinDiv);
                    }

                    const charDiv = document.createElement('div');
                    charDiv.className = 'char-text';
                    charDiv.contentEditable = "true";
                    charDiv.style.color = cColor;
                    charDiv.style.fontSize = (90 * cScale) + "px";
                    charDiv.innerText = word;
                    cardDiv.appendChild(charDiv);
                    
                    pageDiv.appendChild(cardDiv);
                });
                container.appendChild(pageDiv);
            }
        }

        window.onload = generateCards;
    </script>
</body>
</html>
