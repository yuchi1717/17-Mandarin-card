<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>17 Mandarin : å­—å¡ç”¢ç”Ÿå™¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/pinyin-pro"></script>
    <style>
        :root {
            --bg-color: #f9f9f9; 
            --section-bg: #ffffff;
            --primary-brown: #5D4037; 
            --primary-orange: #e67e22; 
            --primary-green: #4db683;
            --light-gray: #eeeeee;
            --text-main: #2c3e50;
            --border-dashed: #d1d5db;
            --placeholder-color: #bbbbbb;
            /* å‹•æ…‹è®Šæ•¸ */
            --page-width: 297mm;
            --page-height: 210mm;
            --page-margin: 15mm;
            --card-gap: 8mm;
        }

        body {
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 0;
            color: var(--text-main);
            display: flex; flex-direction: column; align-items: center;
        }

        header { text-align: center; padding: 40px 0 20px 0; }
        .header-main { display: flex; align-items: baseline; justify-content: center; margin: 0; }
        .brand-name { font-family: 'Pacifico', cursive; line-height: 1; display: flex; align-items: baseline; }
        .brand-17 { font-size: 52px; color: var(--primary-brown); }
        .brand-space { width: 25px; display: inline-block; }
        .brand-text { font-size: 52px; color: var(--primary-orange); }
        .separator { font-size: 32px; color: #ccc; padding: 0 15px; font-weight: 300; }
        .app-name { font-size: 28px; font-weight: bold; color: #333; letter-spacing: 1px; }

        .main-card {
            background: white; width: 95%; max-width: 1100px;
            padding: 30px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            margin-bottom: 50px; box-sizing: border-box;
        }

        textarea {
            width: 100%; height: 80px; padding: 15px; box-sizing: border-box;
            border: 1px solid #eee; border-radius: 12px; font-size: 16px;
            background: #fafafa; resize: none; outline: none; margin-bottom: 20px;
        }
        textarea::placeholder { color: var(--placeholder-color); }

        .settings-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px;
        }

        .setting-box {
            background: #fff; padding: 15px; border-radius: 15px;
            border: 1px solid #f0f0f0; display: flex; flex-direction: column; gap: 10px;
        }

        .setting-header { display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: bold; color: #555; }
        .icon-svg { width: 18px; height: 18px; fill: none; stroke: #777; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

        .control-row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        input[type="number"] { width: 45px; padding: 5px; border: 1px solid #ddd; border-radius: 6px; text-align: center; }
        input[type="range"] { -webkit-appearance: none; flex: 1; height: 4px; background: var(--light-gray); border-radius: 10px; outline: none; border: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--primary-orange); border-radius: 50%; cursor: pointer; }

        .radio-group { display: flex; gap: 10px; }
        .radio-btn { padding: 5px 12px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .radio-btn.active { background: var(--primary-brown); color: white; border-color: var(--primary-brown); }

        .btn-group { display: flex; justify-content: center; gap: 15px; margin-top: 10px; }
        .btn { padding: 12px 28px; border-radius: 12px; font-size: 16px; font-weight: bold; border: none; cursor: pointer; display: flex; align-items: center; gap: 10px; color: white; transition: 0.2s; }
        .btn-orange { background-color: var(--primary-orange); }
        .btn-green { background-color: var(--primary-green); }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }

        /* å­—å¡é è¦½å€ */
        .page {
            width: var(--page-width);
            height: var(--page-height);
            padding: var(--page-margin);
            box-sizing: border-box;
            background: white;
            display: grid;
            gap: var(--card-gap);
            margin-bottom: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            page-break-after: always;
        }

        .card {
            border: 2px dashed var(--border-dashed);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: relative; background: white; box-sizing: border-box; overflow: hidden;
        }
        .card-logo { position: absolute; top: 5%; left: 5%; max-width: 15%; max-height: 15%; object-fit: contain; }
        .pinyin-text, .char-text { text-align: center; outline: none; width: 100%; z-index: 5; word-break: break-all; }

        @media print {
            header, .main-card { display: none !important; }
            body { background: none; padding: 0; }
            .page { margin: 0; box-shadow: none; border: none; }
            /* æ ¹æ“šé¸æ“‡å‹•æ…‹è¨­å®šåˆ—å°æ–¹å‘ */
            @page { size: auto; margin: 0; }
        }
    </style>
</head>
<body>

    <header>
        <h1 class="header-main">
            <span class="brand-name"><span class="brand-17">17</span><span class="brand-space"></span><span class="brand-text">Mandarin</span></span>
            <span class="separator"> : </span><span class="app-name">å­—å¡ç”¢ç”Ÿå™¨</span>
        </h1>
    </header>

    <div class="main-card">
        <textarea id="inputText" placeholder="å¯ä»¥ç”¨ / æˆ–æ˜¯æ›è¡Œæ–·è©" oninput="generateCards()">æ¯å¤©/éƒ½æ˜¯/ç¾å¥½/çš„/ä¸€å¤©/ï¼</textarea>

        <div class="settings-grid">
            <!-- 1. ç‰ˆé¢èˆ‡æ–¹å‘ -->
            <div class="setting-box">
                <div class="setting-header">ğŸ´ ç‰ˆé¢é…ç½®èˆ‡ç´™å¼µæ–¹å‘</div>
                <div class="control-row">
                    æ ¼æ•¸ï¼š<input type="number" id="gridCols" value="3" oninput="generateCards()"> Ã— <input type="number" id="gridRows" value="3" oninput="generateCards()">
                </div>
                <div class="radio-group" id="orientGroup">
                    <div class="radio-btn active" onclick="setOrientation('landscape')">æ©«å¼ (A4)</div>
                    <div class="radio-btn" onclick="setOrientation('portrait')">ç›´å¼ (A4)</div>
                </div>
            </div>

            <!-- 2. æ¼¢å­—è¨­å®š -->
            <div class="setting-box">
                <div class="setting-header">ã„’ æ¼¢å­—é¡è‰²èˆ‡å¤§å°</div>
                <div class="control-row">
                    é¡è‰²ï¼š<input type="color" id="charColor" value="#2c3e50" oninput="generateCards()">
                </div>
                å¤§å°ï¼š<input type="range" id="charScale" min="30" max="200" value="100" oninput="handleSlider(this, 'cVal')">
                <span style="font-size:10px; color:#999; text-align:right" id="cVal">100%</span>
            </div>

            <!-- 3. æ‹¼éŸ³è¨­å®š -->
            <div class="setting-box">
                <div class="setting-header">ğŸ—£ï¸ æ‹¼éŸ³é¡è‰²èˆ‡å¤§å°</div>
                <div class="control-row">
                    é¡è‰²ï¼š<input type="color" id="pinyinColor" value="#7f8c8d" oninput="generateCards()">
                    <label style="font-size:12px; cursor:pointer;"><input type="checkbox" id="showPinyin" checked onchange="generateCards()"> é¡¯ç¤º</label>
                </div>
                å¤§å°ï¼š<input type="range" id="pinyinScale" min="30" max="150" value="100" oninput="handleSlider(this, 'pVal')">
                <span style="font-size:10px; color:#999; text-align:right" id="pVal">100%</span>
            </div>

            <!-- 4. é–“è·èˆ‡é‚Šç•Œ -->
            <div class="setting-box">
                <div class="setting-header">ğŸ“ é–“è·èˆ‡é‚Šç•Œ (mm)</div>
                å­—å¡é–“è·ï¼š<input type="range" id="cardGap" min="0" max="30" value="8" oninput="handleSlider(this, 'gapVal')">
                <span style="font-size:10px; color:#999; text-align:right" id="gapVal">8mm</span>
                é é¢é‚Šç•Œï¼š<input type="range" id="pageMargin" min="0" max="40" value="15" oninput="handleSlider(this, 'marginVal')">
                <span style="font-size:10px; color:#999; text-align:right" id="marginVal">15mm</span>
            </div>

            <!-- 5. Logo åœ–ç‰‡ -->
            <div class="setting-box">
                <div class="setting-header">ğŸ–¼ï¸ Logo åœ–ç‰‡</div>
                <div class="control-row">
                    <label class="upload-btn">ä¸Šå‚³ Logo <input type="file" id="logoInput" accept="image/*" style="display:none"></label>
                    <button id="removeLogoBtn" style="display:none; color: #bbb; border:none; background:none; cursor:pointer; font-size:11px;" onclick="removeLogo()">ç§»é™¤</button>
                </div>
            </div>
        </div>

        <div class="btn-group">
            <button class="btn btn-orange" onclick="generateCards()">âœ¨ ç”¢ç”Ÿå­—å¡</button>
            <button class="btn btn-green" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°æˆ PDF</button>
        </div>
        <p style="text-align:center; font-size:11px; color:#999; margin-top:15px;">èªªæ˜ï¼šå­—å¡è‡ªå‹•åˆ†é ã€‚ç”¢ç”Ÿå¾Œå¯é»æ“Šæ–‡å­—ç›´æ¥ç·¨è¼¯ã€‚</p>
    </div>

    <div id="print-area"></div>

    <script>
        let uploadedLogoBase64 = null;
        let orientation = 'landscape';

        function handleSlider(slider, labelId) {
            document.getElementById(labelId).innerText = (labelId.includes('Val') && !labelId.includes('Scale')) ? slider.value + "mm" : slider.value + "%";
            
            if(slider.id === 'cardGap') document.documentElement.style.setProperty('--card-gap', slider.value + 'mm');
            if(slider.id === 'pageMargin') document.documentElement.style.setProperty('--page-margin', slider.value + 'mm');
            
            generateCards();
        }

        function setOrientation(type) {
            orientation = type;
            const root = document.documentElement;
            const btns = document.querySelectorAll('#orientGroup .radio-btn');
            btns.forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');

            if(type === 'landscape') {
                root.style.setProperty('--page-width', '297mm');
                root.style.setProperty('--page-height', '210mm');
            } else {
                root.style.setProperty('--page-width', '210mm');
                root.style.setProperty('--page-height', '297mm');
            }
            generateCards();
        }

        document.getElementById('logoInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    uploadedLogoBase64 = event.target.result;
                    document.getElementById('removeLogoBtn').style.display = 'inline';
                    generateCards();
                };
                reader.readAsDataURL(file);
            }
        });

        function removeLogo() {
            uploadedLogoBase64 = null;
            document.getElementById('logoInput').value = "";
            document.getElementById('removeLogoBtn').style.display = 'none';
            generateCards();
        }

        function generateCards() {
            const text = document.getElementById('inputText').value;
            const cols = parseInt(document.getElementById('gridCols').value) || 1;
            const rows = parseInt(document.getElementById('gridRows').value) || 1;
            const pScale = document.getElementById('pinyinScale').value / 100;
            const cScale = document.getElementById('charScale').value / 100;
            
            const words = text.split(/[\/\n\r]+/).filter(w => w.trim() !== "");
            const container = document.getElementById('print-area');
            container.innerHTML = '';

            if (words.length === 0) return;

            const itemsPerPage = cols * rows;

            for (let i = 0; i < words.length; i += itemsPerPage) {
                const pageDiv = document.createElement('div');
                pageDiv.className = 'page';
                pageDiv.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
                pageDiv.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
                
                const pageWords = words.slice(i, i + itemsPerPage);
                
                pageWords.forEach(word => {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card';
                    
                    if (uploadedLogoBase64) {
                        const logoImg = document.createElement('img');
                        logoImg.src = uploadedLogoBase64;
                        logoImg.className = 'card-logo';
                        cardDiv.appendChild(logoImg);
                    }

                    if (document.getElementById('showPinyin').checked) {
                        const pinyinDiv = document.createElement('div');
                        pinyinDiv.className = 'pinyin-text';
                        pinyinDiv.contentEditable = "true";
                        pinyinDiv.style.color = document.getElementById('pinyinColor').value;
                        pinyinDiv.style.fontSize = (30 * pScale) + "px";
                        pinyinDiv.innerText = pinyinPro.pinyin(word, { toneType: 'symbol' });
                        cardDiv.appendChild(pinyinDiv);
                    }

                    const charDiv = document.createElement('div');
                    charDiv.className = 'char-text';
                    charDiv.contentEditable = "true";
                    charDiv.style.color = document.getElementById('charColor').value;
                    charDiv.style.fontSize = (80 * cScale) + "px";
                    charDiv.innerText = word;
                    cardDiv.appendChild(charDiv);
                    
                    pageDiv.appendChild(cardDiv);
                });
                container.appendChild(pageDiv);
            }
        }
        window.onload = generateCards;
    </script>
</body>
</html>
